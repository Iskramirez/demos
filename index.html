<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Demos by Rijksmuseum</title>

    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="bootstrap/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">

      <div class="page-header">
        <h1>Rijksmuseum API Demos</h1>
        <p class="lead">Example projects demonstrating usage of the Rijksmuseum API's</p>

        <p class="view"><a href="https://github.com/Rijksmuseum/demos">View the Project on GitHub <small>Rijksmuseum/demos</small></a></p>
      </div>

      <section>
        <h3>Example: loading a single tile</h3>

        <pre>
          <code data-code="example1">
          </code>
        </pre>

        <h4>result</h4>
        <img class="tile" width=256 height=256>
      </section>

      

      <section>
        <h3>Example: loading all tiles in a zoomlevel</h3>

        <pre>
          <code data-code="example2">
          </code>
        </pre>

        <h4>result</h4>
        <div class="example2-container" style="position: relative;">
        </div>
        
      </section>

    </div>


    <script src="javascripts/scale.fix.js"></script>
    <script src="jquery-1.10.2.min.js"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>
    
    <script id="example1" class="example">
      
      // convenience function to download the tiles info for a particular object.
      // The objectNumber passed is the same as used in the Live Api.
      // ex. the objectNumber for the Nightwatch is 'SK-C-5'.

      function loadTiles(objectNumber, callback) {
        return $.getJSON("https://q42imageserver.appspot.com/api/getTilesInfo?object_id=" + 
          objectNumber.toUpperCase(), callback)
      }


      loadTiles("sk-c-5", function(data) {
        // select a zoom level 
        var level = data.levels[0];

        // select a tile frome the zoom level
        var tile= level.tiles[4];
        
        console.log("# of zoom levels:", data.levels.length);
        console.log("tiles in this level: ", level.tiles.length);
        console.log("loading tile: ", tile.url);        
        $(".tile").attr("src", tile.url);
      });
    </script>

    <script id="example2" class="example">
      function loadTiles(objectNumber, callback) {
        return $.getJSON("https://q42imageserver.appspot.com/api/getTilesInfo?object_id=" + 
          objectNumber.toUpperCase(), callback)
      }

      loadTiles("sk-c-5", function(data) { 
        var level = data.levels[0];
        console.log("# of zoom levels:", data.levels.length);
        console.log("tiles in this level: ", level.tiles.length);

        // get the dimensions of the current zoomlevel in pixels:
        console.log("dimensions:", level.width + " x " + level.height);
        var $target = $(".example2-container");
        $target.width(level.width/2);
        $target.height(level.height/2);
        
        // determine the number of rows and columns
        // tiles are always 512 pixels
        // divide the width or height by 512 and round up to get het number of rows or columns:
        var rows = Math.ceil(level.width / 512);
        var columns = Math.ceil(level.height / 512);
        console.log("rows:", rows, "columns:", columns);

       
        console.log(level);
        for(var t=0 ; t<level.tiles.length ; t++)
        {
          var tile = level.tiles[t];
          console.log(t, tile);
          
          var $img = $("<img>").css({
            outline : "1px solid lime",
            position: "absolute",
            left: 256 * tile.x,
            top: 256 * tile.y,
            width: 256,
            height: 256
          }).attr("src", tile.url);

          $target.append($img);
        }

      });
    </script>

    <script>
      $("code").each(function(i,el){
          $(el).text($("#"+$(el).data("code")).text());
      })
    </script>
  </body>
</html>